!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=21)}([function(t,e){t.exports=aliceart},function(t,e){t.exports=nunjucks},function(t,e,n){"use strict";t.exports=function(t){t.addGlobal("JSON",JSON),t.addGlobal("__",t=>t)}},function(t,e){t.exports=function(t,e,n,s){var i=n.root;n.root=function(t,e,n,a,c,r){var l=t.getTemplate;t.getTemplate=function(t,e,i,a,c){"function"==typeof e&&(c=e=!1);var r=function(t){try{return s[t]}catch(e){if(n.get("_require"))return n.get("_require")(t);console.warn('Could not load template "%s"',t)}},l=r(t);n.set("_require",r),e&&l.compile(),c(null,l)},i(t,e,n,a,c,function(e,n){t.getTemplate=l,r(e,n)})};var a={obj:n,type:"code"};return new t.Template(a,e)}},function(t,e){t.exports=aliceart_web_ui},function(t,e,n){"use strict";const{ui:s,assert:i,pick:a,errorMap:c}=n(0),{forms:r,FormComp:l}=n(4),{xbarc:o}=s.modules,d=n(33);t.exports=l.subclass({_init0(t){let{elem:e,params:n}=t,s=this.cell=n.cell,c=this.section=n.section||{};i(s.cid,"missing cid");let r=a(c,"title","html");e.innerHTML=d.render({section:c,form:r}),this.form=this.first("form"),this._applyFormBindings(t)},constraints:{title:{presence:{allowEmpty:!1}},html:{presence:{allowEmpty:!1}}},ckEditors:["textarea"],cancel(){this.cntxEmit("cancel",this)},async save(){let{cell:t,section:e,form:n,constraints:i}=this;if(this.validateForm())return;let l=a(e,"sid");Object.assign(l,s.formJson(n,"title","html"));let d=await o.askApp("doc",{cid:t.cid,section:l},"upsertSection"),p=c(d);if(p)return r.showErrors(n,p);this.cntxEmit("done",this,d)}})},,,,,,,,,,,,,,,,function(t,e,n){t.exports=n(22)},function(t,e,n){n(0).ui.register("doc-admin",n(23))},function(t,e,n){"use strict";const{assert:s,ui:i,errorMap:a,toMap:c}=n(0),{root:r}=i.modules,{FormComp:l}=n(4),o=n(24),d=n(27),p=n(30),u=n(34),m=n(36);t.exports={initIndex(t){let e=i.first(t);f.instance({elem:e})},initDoc(t,e){let n=i.first(t);h.instance({elem:n,cell:e})},initDocEdit(t,e){let n=i.first(t);v.instance({elem:n,cell:e})}};const f=i.Comp.subclass({_init(){this._applyBindings(),u.instance({cntx:this,targetSel:"[data-docs]",penv:{successUrl:`${location.pathname}/cell`}}),this._joinPage(r)}});let h=i.Comp.subclass({_init({elem:t,cell:e}){s(t&&e,"null input"),this.cell=e,this._applyBindings(),this._joinPage(r)}});const v=i.Comp.subclass({_init({elem:t,cell:e,penv:n}){e=this.cell=e,n=this.penv=n||{},this._applyBindings(),d.instance({cntx:this,elem:this.first(".doc-info"),cell:e}),p.instance({cntx:this,elem:this.first(".doc-html"),cell:e});let s=c(e.data.sections,"sid");this.find(".doc-section").forEach(t=>{let n=i.closestData(t,"sid");n&&s[n]&&m.instance({cntx:this,elem:t,cell:e,section:s[n]})}),m.instance({cntx:this,elem:this.first(".section-attach"),cell:e}),o.instance({cntx:this,elem:this.first(".images"),cell:e}),this._joinPage(r)}})},function(t,e,n){const{ui:s}=n(0),i=n(25);t.exports=s.Comp.subclass({_init({cell:t,elem:e}){this.cell=t,this._cards=s.Cards.instance({cntx:this,elem:s.first(e,".images-attach")}),this._applyBindings()},upload(){this._cards.showCard("images",i,{cell:this.cell})}})},function(t,e,n){"use strict";const{ui:s}=n(0),i=n(26);t.exports=s.Comp.subclass({_init({elem:t,params:e}){let n=this.cell=e.cell;t.innerHTML=i.render(),this._applyBindings();let a=n&&n.cid?"/upload?cid="+n.cid:"/upload",c=this.first("[type=file]");$(c).fileinput({uploadUrl:a,uploadAsync:!0,dropZoneEnabled:!1,maxFileCount:5,maxImageWidth:2560,maxImageHeight:1280,maxFileSize:6e3}).on("fileuploaded",function(){s.visit()})}})},function(t,e,n){var s,i=n(1);s=i.currentEnv?i.currentEnv:i.currentEnv=new i.Environment([],void 0);n(2)(s);var a=i.webpackDependencies||(i.webpackDependencies={}),c=n(3);(i.nunjucksPrecompiled=i.nunjucksPrecompiled||{})["client/uploader.nunj"]={root:function(t,e,n,s,i){var a="";try{a+='<div class="card">\n  <div class="card-header">\n    <div class="float-right">\n      <button class="btn btn-outline-secondary btn-sm" data-click="cancel">\n        <span class="fa fa-times"></span>\n      </button>\n    </div>\n    <span class="card-title">',a+=s.suppressValue(s.contextOrFrameLookup(e,n,"title"),t.opts.autoescape),i(null,a+='</span> \n  </div>\n\n  <div class="card-body">\n    <input type="file" multiple/>\n  </div>\n</div>\n')}catch(t){i(s.handleError(t,0,0))}}},t.exports=c(i,s,i.nunjucksPrecompiled["client/uploader.nunj"],a)},function(t,e,n){const{ui:s,assert:i}=n(0),a=n(28);t.exports=s.Cards.subclass({_init({cell:t,penv:e}){this.cell=t||{},this.penv=e||{},this._applyBindings()},editInfo(){let{cell:t}=this;this.showCard("info",a,{cell:t})},on_cancel(t){this.hideCard(t)},on_done(t,e){let{cell:n,penv:i}=this;!n.cid&&e&&e.cid&&i.successUrl?s.visit(i.successUrl+"/"+e.cid):s.visit(i.successUrl)}})},function(t,e,n){"use strict";const{ui:s,assert:i,pick:a,errorMap:c}=n(0),{tagUtils:r,forms:l,FormComp:o}=n(4),{xbarc:d}=s.modules,p=n(29);t.exports=o.subclass({_init0(t){let{elem:e,params:n}=t,s=this.cell=n.cell,{tags:i,mtags:a}=s,{title:c}=s.data,r={tags:i,mtags:a,title:c};e.innerHTML=p.render({cell:s,form:r}),this.form=this.first("form"),this._applyFormBindings(t)},constraints:{title:{presence:{allowEmpty:!1}}},tagFields:["tags","mtags"],cancel(){this.cntxEmit("cancel",this)},async save(){let{cell:t,form:e,tabId:n,constraints:i}=this;if(this.validateForm())return;let r=s.formJson(e,"title","tags","mtags"),o=a(t,"type","cid");o.tags=r.tags?r.tags.split(","):[],o.mtags=r.mtags?r.mtags.split(","):[],o.data={title:r.title};let p=await d.askApp("doc",o,o.cid?"updateDoc":"createDoc"),u=c(p);if(u)return l.showErrors(e,u);this.cntxEmit("done",this,p)}})},function(t,e,n){var s,i=n(1);s=i.currentEnv?i.currentEnv:i.currentEnv=new i.Environment([],void 0);n(2)(s);var a=i.webpackDependencies||(i.webpackDependencies={}),c=n(3);(i.nunjucksPrecompiled=i.nunjucksPrecompiled||{})["client/info-editor.nunj"]={root:function(t,e,n,s,i){var a="";try{a+='<div class="card card-primary mb-4">\n  <div class="card-header">\n    Info\n    <div class="float-right">\n      <button class="btn btn-primary btn-sm" data-click="save">\n        <span class="fa fa-save"></span>\n      </button>\n      <a href="#" class="btn btn-secondary btn-sm" data-click="cancel">\n        <span class="fa fa-times"></span>\n      </a>\n    </div>\n  </div>\n\n  <div class="card-body">\n    <form novalidate>\n      <div class="form-group">\n        <label for="title">Title</label>\n        <input type="text" class="form-control" placeholder="Title" name="title" value="',a+=s.suppressValue(s.memberLookup(s.contextOrFrameLookup(e,n,"form"),"title"),t.opts.autoescape),a+='">\n      </div>\n      <div class="form-group">\n        <label for="tags">tags</label>\n        <input type="text" class="form-control" placeholder="tags" name="tags" value="',a+=s.suppressValue(s.memberLookup(s.contextOrFrameLookup(e,n,"form"),"tags"),t.opts.autoescape),a+='">\n      </div>\n      <div class="form-group">\n        <label for="mtags">mtags</label>\n        <input type="text" class="form-control" placeholder="mtags" name="mtags" value="',a+=s.suppressValue(s.memberLookup(s.contextOrFrameLookup(e,n,"form"),"mtags"),t.opts.autoescape),i(null,a+='">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="hidden" data-errors="">\n      </div>\n    </form>\n  </div>\n</div>\n')}catch(t){i(s.handleError(t,0,0))}}},t.exports=c(i,s,i.nunjucksPrecompiled["client/info-editor.nunj"],a)},function(t,e,n){const{ui:s,assert:i}=n(0),a=n(31);n(5);t.exports=s.Cards.subclass({_init({cell:t,penv:e}){this.cell=t||{},this.penv=e||{},this._applyBindings()},editHtml(){let{cell:t}=this;this.showCard("html",a,{cell:t})},on_cancel(t){this.hideCard(t)},on_done(t,e){let{cell:n,penv:i}=this;!n.cid&&e&&e.cid&&i.successUrl?s.visit(i.successUrl+"/"+e.cid):s.visit(i.successUrl)}})},function(t,e,n){"use strict";const{ui:s,assert:i,pick:a,errorMap:c}=n(0),{forms:r,FormComp:l}=n(4),{xbarc:o}=s.modules,d=n(32);t.exports=l.subclass({_init0(t){let{elem:e,params:n}=t,s=this.cell=n.cell;i(s.cid,"missing cid");let c=a(s.data,"html");e.innerHTML=d.render({cell:s,form:c}),this.form=this.first("form"),this._applyFormBindings(t)},constraints:{html:{presence:{allowEmpty:!1}}},ckEditors:["textarea"],cancel(){this.cntxEmit("cancel",this)},async save(){let{cell:t,form:e}=this;if(this.validateForm())return;let n=a(t,"cid","type");n.data=s.formJson(e,"html");let i=await o.askApp("doc",n,"updateDoc"),l=c(i);if(l)return r.showErrors(e,l);this.cntxEmit("done",this,i)}})},function(t,e,n){var s,i=n(1);s=i.currentEnv?i.currentEnv:i.currentEnv=new i.Environment([],void 0);n(2)(s);var a=i.webpackDependencies||(i.webpackDependencies={}),c=n(3);(i.nunjucksPrecompiled=i.nunjucksPrecompiled||{})["client/html-editor.nunj"]={root:function(t,e,n,s,i){var a="";try{a+='<div class="card card-primary mb-4">\n  <div class="card-header">\n    HTML\n    <div class="float-right">\n      <button class="btn btn-primary btn-sm" data-click="save">\n        <span class="fa fa-save"></span>\n      </button>\n      <a href="#" class="btn btn-secondary btn-sm" data-click="cancel">\n        <span class="fa fa-times"></span>\n      </a>\n    </div>\n  </div>\n\n  <div class="card-body">\n    <form novalidate>\n      <div class="form-group">\n        <label for="html">Html</label>\n        <textarea name="html" class="form-control" rows="5" placeholder="Html">',a+=s.suppressValue(s.memberLookup(s.contextOrFrameLookup(e,n,"form"),"html"),t.opts.autoescape),i(null,a+='</textarea>\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="hidden" data-errors="">\n      </div>\n    </form>\n  </div>\n</div>\n')}catch(t){i(s.handleError(t,0,0))}}},t.exports=c(i,s,i.nunjucksPrecompiled["client/html-editor.nunj"],a)},function(t,e,n){var s,i=n(1);s=i.currentEnv?i.currentEnv:i.currentEnv=new i.Environment([],void 0);n(2)(s);var a=i.webpackDependencies||(i.webpackDependencies={}),c=n(3);(i.nunjucksPrecompiled=i.nunjucksPrecompiled||{})["client/section-editor.nunj"]={root:function(t,e,n,s,i){var a="";try{a+='<div class="card card-primary mb-4">\n  <div class="card-header">\n    Section\n    <div class="float-right">\n      <button class="btn btn-primary btn-sm" data-click="save">\n        <span class="fa fa-save"></span>\n      </button>\n      <a href="#" class="btn btn-secondary btn-sm" data-click="cancel">\n        <span class="fa fa-times"></span>\n      </a>\n    </div>\n  </div>\n\n  <div class="card-body">\n    <form novalidate>\n      <div class="form-group">\n        <label for="title">Title</label>\n        <input type="text" class="form-control" placeholder="Title" name="title" value="',a+=s.suppressValue(s.memberLookup(s.contextOrFrameLookup(e,n,"form"),"title"),t.opts.autoescape),a+='">\n\n      </div>\n      <div class="form-group">\n        <label for="html">Html</label>\n        <textarea name="html" class="form-control" rows="5" placeholder="Html">',a+=s.suppressValue(s.memberLookup(s.contextOrFrameLookup(e,n,"form"),"html"),t.opts.autoescape),i(null,a+='</textarea>\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="hidden" data-errors="">\n      </div>\n    </form>\n  </div>\n</div>\n')}catch(t){i(s.handleError(t,0,0))}}},t.exports=c(i,s,i.nunjucksPrecompiled["client/section-editor.nunj"],a)},function(t,e,n){const{ui:s,assert:i,pick:a,errorMap:c}=n(0),{forms:r,FormComp:l}=n(4),{xbarc:o}=s.modules,d=n(35);t.exports=s.Cards.subclass({_init({cell:t,penv:e}){this.cell=t||{type:"doc"},i("doc"===this.cell.type,"not doc"),this.penv=e||{},this._applyBindings()},addDoc(t){this.showCard("doc",p,{cell:this.cell})},on_cancel(t){this.hideCard(t)},on_done(t,e){let{cell:n,penv:i}=this;!n.cid&&e&&e.cid&&i.successUrl?s.visit(`${i.successUrl}/${e.cid}/edit`):s.visit(i.successUrl)}});const p=l.subclass({_init0(t){let{elem:e,params:n}=t,s=this.cell=n.cell;i("doc"===s.type,"not doc cell");let c=a(s.data,"title","html");e.innerHTML=d.render({form:c}),this.form=this.first("form"),this._applyFormBindings(t)},constraints:{cid:{format:{pattern:"^[a-z0-9]+(-[a-z0-9]+)*$",message:"can only contains a-z, 0-9, and -"}},title:{presence:{allowEmpty:!1}},html:{presence:{allowEmpty:!1}}},ckEditors:["textarea"],cancel(){this.cntxEmit("cancel",this)},async save(){let{cell:t,form:e}=this;if(this.validateForm())return;let n=s.formJson(e,"cid","title","html"),i={...a(t,"type"),...a(n,"cid"),data:a(n,"title","html")},l=await o.askApp("doc",i,"createDoc"),d=c(l);if(d)return r.showErrors(e,d);this.cntxEmit("done",this,l)}})},function(t,e,n){var s,i=n(1);s=i.currentEnv?i.currentEnv:i.currentEnv=new i.Environment([],void 0);n(2)(s);var a=i.webpackDependencies||(i.webpackDependencies={}),c=n(3);(i.nunjucksPrecompiled=i.nunjucksPrecompiled||{})["client/doc-editor.nunj"]={root:function(t,e,n,s,i){var a="";try{a+='<div class="card card-primary mb-4">\n  <div class="card-header">\n    Doc\n    <div class="float-right">\n      <button class="btn btn-primary btn-sm" data-click="save">\n        <span class="fa fa-save"></span>\n      </button>\n      <a href="#" class="btn btn-secondary btn-sm" data-click="cancel">\n        <span class="fa fa-times"></span>\n      </a>\n    </div>\n  </div>\n\n  <div class="card-body">\n    <form novalidate>\n      <div class="form-group">\n        <label for="title">cid</label>\n        <input type="text" class="form-control" placeholder="cid" name="cid" value="',a+=s.suppressValue(s.memberLookup(s.contextOrFrameLookup(e,n,"form"),"cid"),t.opts.autoescape),a+='">\n      </div>\n\n      <div class="form-group">\n        <label for="title">Title</label>\n        <input type="text" class="form-control" placeholder="Title" name="title" value="',a+=s.suppressValue(s.memberLookup(s.contextOrFrameLookup(e,n,"form"),"title"),t.opts.autoescape),a+='">\n      </div>\n      <div class="form-group">\n        <label for="html">Html</label>\n        <textarea name="html" class="form-control" rows="5" placeholder="Html">',a+=s.suppressValue(s.memberLookup(s.contextOrFrameLookup(e,n,"form"),"html"),t.opts.autoescape),i(null,a+='</textarea>\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="hidden" data-errors="">\n      </div>\n    </form>\n  </div>\n</div>\n')}catch(t){i(s.handleError(t,0,0))}}},t.exports=c(i,s,i.nunjucksPrecompiled["client/doc-editor.nunj"],a)},function(t,e,n){const{ui:s,assert:i}=n(0),a=n(5);t.exports=s.Cards.subclass({_init({cell:t,section:e,penv:n}){this.cell=t||{},this.section=e||{},this.penv=n||{},this._applyBindings()},addSection(t){let{cell:e,section:n}=this;this.showCard("section",a,{cell:e})},editSection(t){let{cell:e,section:n}=this;s.closestData(t,"sid");this.showCard("section",a,{cell:e,section:n})},on_cancel(t){this.hideCard(t)},on_done(t,e){let{cell:n,penv:i}=this;!n.cid&&e&&e.cid&&i.successUrl?s.visit(i.successUrl+"/"+e.cid):s.visit(i.successUrl)}})}]);