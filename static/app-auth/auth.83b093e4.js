!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=4)}([function(e,n){e.exports=nunjucks},function(e,n,t){"use strict";e.exports=function(e){e.addGlobal("JSON",JSON),e.addGlobal("__",e=>e)}},function(e,n){e.exports=function(e,n,t,o){var r=t.root;t.root=function(e,n,t,a,s,l){var i=e.getTemplate;e.getTemplate=function(e,n,r,a,s){"function"==typeof n&&(s=n=!1);var l=function(e){try{return o[e]}catch(n){if(t.get("_require"))return t.get("_require")(e);console.warn('Could not load template "%s"',e)}},i=l(e);t.set("_require",l),n&&i.compile(),s(null,i)},r(e,n,t,a,s,function(n,t){e.getTemplate=i,l(n,t)})};var a={obj:t,type:"code"};return new e.Template(a,n)}},function(e,n){e.exports=aliceart},function(e,n,t){e.exports=t(5)},function(e,n,t){t(3).ui.register("auth-app",t(6))},function(e,n,t){"use strict";const o=t(7),{ui:r,pick:a,omit:s,errorMap:l}=t(3),{FormComp:i,forms:c}=t(8),{xbarc:u,root:d,profile:m}=r.modules,p=t(9),f=t(10),b=t(11);let v=null;e.exports={initAuth(e){if(v)return v.updateUser();let n=r.first(e);v=h.instance({elem:n})}};const h=r.Comp.subclass({_init({elem:e}){this._initUser(),this._updateMenu(),this._applyBindings(),this._joinPage(d)},updateUser(){this._initUser(),this._updateMenu()},_initUser(){if(m._id)this._user={...m};else{let e=localStorage.getItem("_user"),n=localStorage.getItem("_token");try{let t=this._user=e?JSON.parse(e):{};t._id&&n?(Object.assign(m,t),document.body.classList.add("member")):this._clearUser()}catch(e){this._clearUser()}}},_clearUser(){this._user={},localStorage.removeItem("_user"),localStorage.removeItem("_token"),delete m._id,delete m.role,delete m.email,m.name="Guest",document.body.classList.remove("member")},_updateMenu(){this.elem.innerHTML=p.render({profile:this._user})},login(){let e=o(f.render());o("body").append(e),y.instance({cntx:this,elem:e[0],form:"form"}),e.modal()},signup(){let e=o(b.render());o("body").append(e),g.instance({cntx:this,elem:e[0],form:"form"}),e.modal()},async logout(){await u.askApp("auth",{},"logout"),this._clearUser(),this._updateMenu(),r.visit()},async echo(){let e=await u.askApp("auth",{abc:"def"},"echo");alert("RRRRRR "+JSON.stringify(e,null,2))},on_done(e,n){n.user&&n.user._id&&n.token?(this._user=n.user,localStorage.setItem("_user",JSON.stringify(this._user)),localStorage.setItem("_token",n.token),Object.assign(m,n.user),document.body.classList.add("member")):this._clearUser(),this._updateMenu(),r.visit()}}),y=i.subclass({constraints:{uid:{presence:{allowEmpty:!1}},password:{presence:{allowEmpty:!1}}},async save(){let{elem:e,form:n}=this;if(this.validateForm())return;let t=r.formJson(n,"uid","password"),a=await u.askApp("auth",t,"login"),s=l(a);if(s)return c.showErrors(n,s);this.cntxEmit("done",this,a),o(e).modal("hide")}}),g=i.subclass({constraints:{uid:{presence:{allowEmpty:!1}},email:{presence:{allowEmpty:!1}},name:{presence:{allowEmpty:!1}},password:{presence:{allowEmpty:!1}},password2:{presence:{allowEmpty:!1}}},async save(){let{elem:e,form:n}=this;if(this.validateForm())return;let t=r.formJson(n,"uid","email","name","password","password2");if(t.password!==t.password2)return c.showErrors(n,{password2:["Passwords not matched"]});let s=a(t,"uid","email","name","password"),i=await u.askApp("auth",{user:s},"signUp"),d=l(i);if(d)return c.showErrors(n,d);this.cntxEmit("done",this,i),o(e).modal("hide")}})},function(e,n){e.exports=jQuery},function(e,n){e.exports=aliceart_web_ui},function(e,n,t){var o,r=t(0);o=r.currentEnv?r.currentEnv:r.currentEnv=new r.Environment([],{dev:!1,autoescape:!0,throwOnUndefined:!1,trimBlocks:!1,lstripBlocks:!1});t(1)(o);var a=r.webpackDependencies||(r.webpackDependencies={}),s=t(2);(r.nunjucksPrecompiled=r.nunjucksPrecompiled||{})["client/user-menu.nunj"]={root:function(e,n,t,o,r){var a="";try{a+="  ",o.memberLookup(o.contextOrFrameLookup(n,t,"profile"),"_id")?(a+='\n  <form class="form-inline mt-2 mt-md-0">\n    ',"admin"==o.memberLookup(o.contextOrFrameLookup(n,t,"profile"),"role")&&"web"==o.memberLookup(o.contextOrFrameLookup(n,t,"profile"),"mode")&&(a+='\n    <a href="/admin" class="btn btn-outline-secondary my-2 my-sm-0 mr-2">\n      Admin\n    </a>\n    '),a+='\n    <a href="#" class="btn btn-outline-secondary my-2 my-sm-0 mr-2">\n      ',o.memberLookup(o.contextOrFrameLookup(n,t,"profile"),"avatar_url")&&(a+='\n      <img src="',a+=o.suppressValue(o.memberLookup(o.contextOrFrameLookup(n,t,"profile"),"avatar_url"),e.opts.autoescape),a+='" width="24" height="24" class="rounded mr-2">\n      '),a+="\n      ",a+=o.suppressValue(o.memberLookup(o.contextOrFrameLookup(n,t,"profile"),"name"),e.opts.autoescape),a+='\n    </a>\n    <a href="#" data-click="logout"\n       class="btn btn-outline-danger my-2 my-sm-0">\n      Logout\n    </a>\n  </form>\n  '):a+='\n  <form class="form-inline mt-2 mt-md-0">\n    <a href="#" data-click="signup"\n       class="btn btn-outline-info my-2 my-sm-0 mr-2">\n      Signup\n    </a>\n    <a href="#" data-click="login"\n       class="btn btn-outline-success my-2 my-sm-0">\n      Login\n    </a>\n  </form>\n  ',r(null,a+="\n")}catch(e){r(o.handleError(e,0,0))}}},e.exports=s(r,o,r.nunjucksPrecompiled["client/user-menu.nunj"],a)},function(e,n,t){var o,r=t(0);o=r.currentEnv?r.currentEnv:r.currentEnv=new r.Environment([],void 0);t(1)(o);var a=r.webpackDependencies||(r.webpackDependencies={}),s=t(2);(r.nunjucksPrecompiled=r.nunjucksPrecompiled||{})["client/auth-login.nunj"]={root:function(e,n,t,o,r){var a="";try{r(null,a+='<div class="modal" tabindex="-1" role="dialog">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title">Login</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <form novalidate>\n          <div class="form-group">\n            <label for="uid">User ID or e-mail</label>\n            <input type="text" class="form-control" placeholder="ID or e-mail" name="uid">\n\n          </div>\n          <div class="form-group">\n            <label for="password">Password</label>\n            <input type="password" class="form-control" placeholder="Password" name="password">\n          </div>\n          <div class="form-group">\n            <input class="form-control" type="hidden" data-errors="">\n          </div>\n        </form>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n        <button type="button" class="btn btn-primary"\n                data-click="save">Save changes</button>\n      </div>\n    </div>\n  </div>\n</div>\n')}catch(e){r(o.handleError(e,0,0))}}},e.exports=s(r,o,r.nunjucksPrecompiled["client/auth-login.nunj"],a)},function(e,n,t){var o,r=t(0);o=r.currentEnv?r.currentEnv:r.currentEnv=new r.Environment([],void 0);t(1)(o);var a=r.webpackDependencies||(r.webpackDependencies={}),s=t(2);(r.nunjucksPrecompiled=r.nunjucksPrecompiled||{})["client/auth-signup.nunj"]={root:function(e,n,t,o,r){var a="";try{r(null,a+='<div class="modal" tabindex="-1" role="dialog">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title">Signup</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <form novalidate>\n          <div class="form-group">\n            <label for="uid">User ID</label>\n            <input type="text" class="form-control" placeholder="User ID" name="uid">\n          </div>\n          <div class="form-group">\n            <label for="uid">E-mail</label>\n            <input type="email" class="form-control" placeholder="E-mail" name="email">\n          </div>\n          <div class="form-group">\n            <label for="name">Name</label>\n            <input type="text" class="form-control" placeholder="Name" name="name">\n          </div>\n          <div class="form-group">\n            <label for="password">Password</label>\n            <input type="password" class="form-control" placeholder="Password" name="password">\n          </div>\n          <div class="form-group">\n            <label for="password2">Re-enter password</label>\n            <input type="password" class="form-control" placeholder="Re-enter password"\n                   name="password2">\n          </div>\n          <div class="form-group">\n            <input class="form-control" type="hidden" data-errors="">\n          </div>\n        </form>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n        <button type="button" class="btn btn-primary"\n                data-click="save">Submit</button>\n      </div>\n    </div>\n  </div>\n</div>\n')}catch(e){r(o.handleError(e,0,0))}}},e.exports=s(r,o,r.nunjucksPrecompiled["client/auth-signup.nunj"],a)}]);
//# sourceMappingURL=auth.83b093e4.js.map